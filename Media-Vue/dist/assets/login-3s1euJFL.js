import{d as h,r as n,o as x,a as V,w as S,c as T,b as i,e as s,f as t,g as B,h as u,n as C,u as F,i as N,j as I,k as v,E as p}from"./index-DrTqUjeq.js";import{r as q,_ as E}from"./_plugin-vue_export-helper-DzaqoFoA.js";const O={id:"login"},R={id:"login-btn"},J=h({__name:"login",setup(K){const w=N();let c=n("");x(()=>{const r=localStorage.getItem("userToken");if(r)try{c.value=JSON.parse(r).loginBackground}catch(e){console.error("解析 userToken 失败:",e)}});const o=n({name:"",password:""}),g=n(!0),l=n(),b=V({name:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:10,message:"长度在2-10个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:4,max:20,message:"长度在4-20个字符",trigger:"blur"}]});S(o,()=>{g.value=!(o.value.name.length>=2&&o.value.name.length<=10&&o.value.password.length>=4&&o.value.password.length<=20)},{deep:!0});const f=async()=>{l.value&&await l.value.validate(async(r,e)=>{if(r)try{const a=await q({url:"/user/login",method:"POST",data:{account:o.value.name,password:o.value.password}});a.code===200?(p({message:"登录成功",type:"success"}),localStorage.setItem("userToken",JSON.stringify(a.data)),w.push({name:"home"})):(console.error("登录失败:",a.message),p({message:"登录失败: "+a.message,type:"error"}))}catch(a){console.error("登录请求失败:",a),p({message:"登录请求失败，请检查网络连接",type:"error"})}else console.log("表单校验失败",e)})},y=()=>{l.value.resetFields(),o.value={name:"",password:""}};return(r,e)=>{const a=u("el-input"),d=u("el-form-item"),_=u("el-button"),k=u("el-form");return I(),T("div",{id:"background-login",style:C({backgroundImage:"url("+F(c)+")"})},[i("div",O,[e[4]||(e[4]=i("h1",{id:"logintitle"},"你好 ʕ´• ᴥ•̥`ʔ ！",-1)),s(k,{ref_key:"formRef",ref:l,style:{"max-width":"80%"},model:o.value,"status-icon":"",rules:b,"label-width":"auto",onKeyup:B(f,["enter"])},{default:t(()=>[s(d,{label:"用户名",prop:"name"},{default:t(()=>[s(a,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=m=>o.value.name=m),type:"text",placeholder:"账号 2~10"},null,8,["modelValue"])]),_:1}),s(d,{label:"密码",prop:"password"},{default:t(()=>[s(a,{modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=m=>o.value.password=m),type:"password",placeholder:"密码 6~20"},null,8,["modelValue"])]),_:1}),s(d,null,{default:t(()=>[i("div",R,[s(_,{onClick:y},{default:t(()=>e[2]||(e[2]=[v("重置",-1)])),_:1,__:[2]}),s(_,{type:"primary",onClick:f,disabled:g.value},{default:t(()=>e[3]||(e[3]=[v("登录",-1)])),_:1,__:[3]},8,["disabled"])])]),_:1})]),_:1},8,["model","rules"])])],4)}}}),j=E(J,[["__scopeId","data-v-fe8c48a4"]]);export{j as default};
