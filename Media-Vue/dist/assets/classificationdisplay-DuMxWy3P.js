import{r as c,o as ue,l as de,c as f,b as u,q as C,p as ve,e as y,f as x,u as M,R as me,h as j,F as z,y as fe,S as he,T as pe,t as S,A as ye,z as _,B as we,n as ge,U as xe,C as F,i as _e,j as m,E as D}from"./index-DrTqUjeq.js";import{_ as be,r as ke}from"./_plugin-vue_export-helper-DzaqoFoA.js";const Ce={class:"page-container"},Me={class:"top-bar"},Se=["onClick"],Te={class:"media-content-wrapper"},Ue=["src","alt"],qe={key:1,class:"video-thumbnail-container"},We=["src","alt"],Ee={key:1,class:"empty-data"},$e={key:2,class:"loading-more"},He={key:3,class:"no-more-data"},Le={class:"scroll-buttons"},Ne={class:"media-info"},Be=["src","alt"],Fe=["src"],De={__name:"classificationdisplay",setup(Re){const s=c([]),w=c("http://10.10.10.101"),T=c(1),K=c(50),U=c(!0),b=c(!1),E=c(!1),q=c(!1),n=c(0),h=c(""),d=c(1),r=c(1),O=c(5),W=c(!1),p=c({x:0,y:0}),$=c({x:0,y:0}),H=c({x:0,y:0}),G=xe(),J=_e(),R=async(e=!1)=>{if(!(e&&(!U.value||b.value)))try{b.value=!0;const o=G.query.id;e?T.value++:T.value=1;const a={toolId:o,page:T.value,pageSize:K.value},t=await ke({url:"/media/list",method:"GET",params:a});if(t.code===200){const l=t.data.records.filter(i=>i.mimeType&&(i.mimeType.startsWith("image/")||i.mimeType.startsWith("video/")));e?s.value=[...s.value,...l]:s.value=l,U.value=t.data.current<t.data.pages,!U.value&&e&&(E.value=!0,setTimeout(()=>{E.value=!1},1500))}}catch(o){console.error("获取媒体列表失败:",o),e&&T.value--}finally{b.value=!1}},Q=e=>e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":(e/(1024*1024)).toFixed(2)+" MB",Z=e=>{if(e.length<=12)return e;{const o=e.substring(0,6),a=e.substring(e.length-6);return o+"..."+a}},ee=e=>{if(!e)return"";const o=e.split("/");return o.length>1?o[1]:e},I=((e,o)=>{let a;return function(...l){const i=()=>{clearTimeout(a),e(...l)};clearTimeout(a),a=setTimeout(i,o)}})(()=>{const e=document.querySelector(".page-container");if(!e)return;const o=e.scrollTop,a=e.scrollHeight,t=e.clientHeight;a-o-t<100&&U.value&&!b.value&&R(!0)},200),L=e=>new Promise((o,a)=>{const t=new Image;t.onload=()=>{o({width:t.naturalWidth,height:t.naturalHeight})},t.onerror=a,t.src=e}),te=e=>{if(h.value!=="image")return;e.preventDefault();const o=e.deltaY>0?-.1:.1,a=d.value+o;if(a>=r.value&&a<=O.value){d.value=a;const t=document.querySelector(".viewer-media");t&&(t.style.transform=`translate(${p.value.x}px, ${p.value.y}px) scale(${d.value})`)}},ae=e=>{h.value!=="image"||d.value<=r.value||(W.value=!0,$.value={x:e.clientX,y:e.clientY},H.value={x:p.value.x,y:p.value.y},e.preventDefault())},oe=e=>{if(!W.value)return;const o=e.clientX-$.value.x,a=e.clientY-$.value.y;p.value={x:H.value.x+o,y:H.value.y+a};const t=document.querySelector(".viewer-media");t&&(t.style.transform=`translate(${p.value.x}px, ${p.value.y}px) scale(${d.value})`)},P=()=>{W.value=!1},N=()=>{d.value=r.value,p.value={x:0,y:0};const e=document.querySelector(".viewer-media");e&&(e.style.transform=`translate(0px, 0px) scale(${r.value})`)},le=async e=>{n.value=e;const o=s.value[e];if(h.value=o.mimeType.startsWith("image/")?"image":"video",N(),h.value==="image")try{await F();const a=w.value+o.fileUrl,t=await L(a),l=document.querySelector(".media-viewer-content");if(l){const i=l.clientWidth,v=l.clientHeight,k=i/t.width,g=v/t.height;r.value=Math.max(k,g,1),d.value=r.value;const A=document.querySelector(".viewer-media");A&&(A.style.transform=`translate(0px, 0px) scale(${r.value})`)}}catch(a){console.error("获取图片尺寸失败:",a),r.value=1,d.value=1}q.value=!0},B=()=>{q.value=!1},Y=async()=>{n.value=n.value>0?n.value-1:s.value.length-1;const e=s.value[n.value];if(h.value=e.mimeType.startsWith("image/")?"image":"video",h.value==="image")try{await F();const o=w.value+e.fileUrl,a=await L(o),t=document.querySelector(".media-viewer-content");if(t){const l=t.clientWidth,i=t.clientHeight,v=l/a.width,k=i/a.height;r.value=Math.max(v,k,1),d.value=r.value;const g=document.querySelector(".viewer-media");g&&(g.style.transform=`translate(0px, 0px) scale(${r.value})`)}}catch(o){console.error("获取图片尺寸失败:",o),r.value=1,d.value=1;const a=document.querySelector(".viewer-media");a&&(a.style.transform="translate(0px, 0px) scale(1)")}else N()},X=async()=>{n.value=n.value<s.value.length-1?n.value+1:0;const e=s.value[n.value];if(h.value=e.mimeType.startsWith("image/")?"image":"video",h.value==="image")try{await F();const o=w.value+e.fileUrl,a=await L(o),t=document.querySelector(".media-viewer-content");if(t){const l=t.clientWidth,i=t.clientHeight,v=l/a.width,k=i/a.height;r.value=Math.max(v,k,1),d.value=r.value;const g=document.querySelector(".viewer-media");g&&(g.style.transform=`translate(0px, 0px) scale(${r.value})`)}}catch(o){console.error("获取图片尺寸失败:",o),r.value=1,d.value=1;const a=document.querySelector(".viewer-media");a&&(a.style.transform="translate(0px, 0px) scale(1)")}else N()},V=e=>{if(q.value)switch(e.key){case"ArrowLeft":Y();break;case"ArrowRight":X();break;case"Escape":B();break}};ue(()=>{R();const e=document.querySelector(".page-container");e&&e.addEventListener("scroll",I),window.addEventListener("keydown",V)}),de(()=>{const e=document.querySelector(".page-container");e&&e.removeEventListener("scroll",I),window.removeEventListener("keydown",V)});const se=()=>{const e=document.querySelector(".page-container");e&&e.scrollTo({top:0,behavior:"smooth"})},ne=()=>{const e=document.querySelector(".page-container");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},re=()=>{J.push("/finishing")},ce=async()=>{const e=s.value[n.value],o=w.value+e.fileUrl,a=e.fileName;try{const t=await fetch(o);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const l=await t.blob(),i=URL.createObjectURL(l),v=document.createElement("a");v.href=i,v.download=a,v.style.display="none",document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(i)}catch(t){console.error("下载文件失败:",t);const l=document.createElement("a");l.href=o,l.download=a,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}},ie=async()=>{const e=s.value[n.value],o=w.value+e.fileUrl;try{await navigator.clipboard.writeText(o),D.success("文件地址已复制到剪贴板")}catch(a){console.error("Clipboard API 失败:",a);try{const t=document.createElement("textarea");t.value=o,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.select();const l=document.execCommand("copy");if(document.body.removeChild(t),l)D.success("文件地址已复制到剪贴板");else throw new Error("execCommand 复制失败")}catch(t){console.error("备选复制方法失败:",t),D.error("复制文件地址失败，请手动复制")}}};return(e,o)=>{const a=j("el-icon"),t=j("masonry");return m(),f(z,null,[u("div",Ce,[u("div",Me,[y(a,{class:"back-button",onClick:re},{default:x(()=>[y(M(me))]),_:1})]),s.value.length>0?(m(),ve(t,{key:0,cols:{default:5,1200:4,1024:3,768:2,500:1},gutter:{default:"5px"}},{default:x(()=>[(m(!0),f(z,null,fe(s.value,(l,i)=>(m(),f("div",{class:"item",key:l.fileId,onClick:v=>le(i)},[u("div",Te,[l.mimeType.startsWith("image/")?(m(),f("img",{key:0,src:w.value+l.thumbnailUrl,alt:l.fileName,class:"media-thumbnail"},null,8,Ue)):l.mimeType.startsWith("video/")?(m(),f("div",qe,[u("img",{src:w.value+l.thumbnailUrl,alt:l.fileName,class:"media-thumbnail"},null,8,We),o[1]||(o[1]=u("div",{class:"play-icon"},"▶",-1))])):C("",!0)])],8,Se))),128))]),_:1})):(m(),f("div",Ee,"当前分类没有数据哦！")),b.value?(m(),f("div",$e,"加载中...")):C("",!0),E.value?(m(),f("div",He,"已经到底啦！")):C("",!0),u("div",Le,[y(a,{class:"scroll-button",onClick:se},{default:x(()=>[y(M(he))]),_:1}),y(a,{class:"scroll-button",onClick:ne},{default:x(()=>[y(M(pe))]),_:1})])]),q.value?(m(),f("div",{key:0,class:"media-viewer-modal",onClick:B},[u("div",Ne,[u("h3",null,S(Z(s.value[n.value].fileName)),1),u("p",null,"文件大小: "+S(Q(s.value[n.value].fileSize)),1),u("p",null,"尺寸: "+S(s.value[n.value].width)+" x "+S(s.value[n.value].height),1),u("p",null,"文件类型: "+S(ee(s.value[n.value].mimeType)),1),y(a,{class:"copy-icon",onClick:_(ie,["stop"])},{default:x(()=>[y(M(ye))]),_:1}),y(a,{class:"download-icon",onClick:_(ce,["stop"])},{default:x(()=>[y(M(we))]),_:1})]),u("button",{class:"nav-button prev",onClick:_(Y,["stop"])},"‹"),u("button",{class:"nav-button next",onClick:_(X,["stop"])},"›"),u("button",{class:"close-button",onClick:_(B,["stop"])},"×"),u("div",{class:"media-viewer-content",onClick:o[0]||(o[0]=_(()=>{},["stop"])),onWheel:te,onMousemove:oe,onMouseup:P,onMouseleave:P},[h.value==="image"?(m(),f("img",{key:0,src:w.value+s.value[n.value].fileUrl,alt:s.value[n.value].fileName,class:"viewer-media",style:ge({transform:`translate(${p.value.x}px, ${p.value.y}px) scale(${d.value})`,transition:W.value?"none":"transform 0.1s ease",cursor:d.value>r.value?"grab":"default"}),onMousedown:ae},null,44,Be)):h.value==="video"?(m(),f("video",{key:1,src:w.value+s.value[n.value].fileUrl,controls:"",autoplay:"",class:"viewer-media"}," 您的浏览器不支持视频播放。 ",8,Fe)):C("",!0)],32)])):C("",!0)],64)}}},Xe=be(De,[["__scopeId","data-v-00c1c241"]]);export{Xe as default};
