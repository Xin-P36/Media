import{r as c,o as se,l as ne,c as f,b as v,q as b,p as re,f as L,F as A,y as ie,z as g,e as T,t as k,u as j,A as ce,h as z,B as ue,n as de,C as D,j as m,E as F}from"./index-DrTqUjeq.js";import{_ as ve,r as me}from"./_plugin-vue_export-helper-DzaqoFoA.js";const fe={class:"page-container"},he=["onClick"],pe={class:"media-content-wrapper"},ye=["src","alt"],we={key:1,class:"video-thumbnail-container"},ge=["src","alt"],xe={key:1,class:"empty-data"},_e={key:2,class:"loading-more"},be={key:3,class:"no-more-data"},ke={class:"media-info"},Me=["src","alt"],Ce=["src"],Se={__name:"show",setup(Ue){const s=c([]),y=c("http://10.10.10.101"),M=c(1),K=c(50),C=c(!0),x=c(!1),E=c(!1),S=c(!1),n=c(0),h=c(""),d=c(1),r=c(1),O=c(5),U=c(!1),p=c({x:0,y:0}),W=c({x:0,y:0}),$=c({x:0,y:0}),I=async(e=!1)=>{if(!(e&&(!C.value||x.value)))try{x.value=!0;const a=localStorage.getItem("defaultDisplay"),l=localStorage.getItem("defaultNumberPages");e?M.value++:M.value=1;const t={page:M.value,pageSize:l||K.value};a&&(t.toolId=a);const o=await me({url:"/media/list",method:"GET",params:t});if(o.code===200){const u=o.data.records.filter(i=>i.mimeType&&(i.mimeType.startsWith("image/")||i.mimeType.startsWith("video/")));e?s.value=[...s.value,...u]:s.value=u,C.value=o.data.current<o.data.pages,!C.value&&e&&(E.value=!0,setTimeout(()=>{E.value=!1},1500))}}catch(a){console.error("获取媒体列表失败:",a),e&&M.value--}finally{x.value=!1}},G=e=>e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":(e/(1024*1024)).toFixed(2)+" MB",J=e=>{if(e.length<=12)return e;const a=e.substring(0,6),l=e.substring(e.length-6);return a+"..."+l},Q=e=>{if(!e)return"";const a=e.split("/");return a.length>1?a[1]:e},P=((e,a)=>{let l;return function(...o){const u=()=>{clearTimeout(l),e(...o)};clearTimeout(l),l=setTimeout(u,a)}})(()=>{const e=document.documentElement.scrollTop||document.body.scrollTop,a=document.documentElement.scrollHeight,l=document.documentElement.clientHeight;a-e-l<100&&C.value&&!x.value&&I(!0)},200),B=e=>{if(S.value)switch(e.key){case"ArrowLeft":Y();break;case"ArrowRight":R();break;case"Escape":N();break}},q=e=>new Promise((a,l)=>{const t=new Image;t.onload=()=>{a({width:t.naturalWidth,height:t.naturalHeight})},t.onerror=l,t.src=e}),Z=async e=>{n.value=e;const a=s.value[e];if(h.value=a.mimeType.startsWith("image/")?"image":"video",H(),h.value==="image")try{await D();const l=y.value+a.fileUrl,t=await q(l),o=document.querySelector(".media-viewer-content");if(o){const u=o.clientWidth,i=o.clientHeight,_=u/t.width,w=i/t.height;r.value=Math.max(_,w,1),d.value=r.value;const V=document.querySelector(".viewer-media");V&&(V.style.transform=`translate(0px, 0px) scale(${r.value})`)}}catch(l){console.error("获取图片尺寸失败:",l),r.value=1,d.value=1}S.value=!0},N=()=>{S.value=!1},Y=async()=>{n.value=n.value>0?n.value-1:s.value.length-1;const e=s.value[n.value];if(h.value=e.mimeType.startsWith("image/")?"image":"video",h.value==="image")try{await D();const a=y.value+e.fileUrl,l=await q(a),t=document.querySelector(".media-viewer-content");if(t){const o=t.clientWidth,u=t.clientHeight,i=o/l.width,_=u/l.height;r.value=Math.max(i,_,1),d.value=r.value;const w=document.querySelector(".viewer-media");w&&(w.style.transform=`translate(0px, 0px) scale(${r.value})`)}}catch(a){console.error("获取图片尺寸失败:",a),r.value=1,d.value=1;const l=document.querySelector(".viewer-media");l&&(l.style.transform="translate(0px, 0px) scale(1)")}else H()},R=async()=>{n.value=n.value<s.value.length-1?n.value+1:0;const e=s.value[n.value];if(h.value=e.mimeType.startsWith("image/")?"image":"video",h.value==="image")try{await D();const a=y.value+e.fileUrl,l=await q(a),t=document.querySelector(".media-viewer-content");if(t){const o=t.clientWidth,u=t.clientHeight,i=o/l.width,_=u/l.height;r.value=Math.max(i,_,1),d.value=r.value;const w=document.querySelector(".viewer-media");w&&(w.style.transform=`translate(0px, 0px) scale(${r.value})`)}}catch(a){console.error("获取图片尺寸失败:",a),r.value=1,d.value=1;const l=document.querySelector(".viewer-media");l&&(l.style.transform="translate(0px, 0px) scale(1)")}else H()},ee=e=>{if(h.value!=="image")return;e.preventDefault();const a=e.deltaY>0?-.1:.1,l=d.value+a;if(l>=r.value&&l<=O.value){d.value=l;const t=document.querySelector(".viewer-media");t&&(t.style.transform=`translate(${p.value.x}px, ${p.value.y}px) scale(${d.value})`)}},te=e=>{h.value!=="image"||d.value<=r.value||(U.value=!0,W.value={x:e.clientX,y:e.clientY},$.value={x:p.value.x,y:p.value.y},e.preventDefault())},ae=e=>{if(!U.value)return;const a=e.clientX-W.value.x,l=e.clientY-W.value.y;p.value={x:$.value.x+a,y:$.value.y+l};const t=document.querySelector(".viewer-media");t&&(t.style.transform=`translate(${p.value.x}px, ${p.value.y}px) scale(${d.value})`)},X=()=>{U.value=!1},H=()=>{d.value=r.value,p.value={x:0,y:0};const e=document.querySelector(".viewer-media");e&&(e.style.transform=`translate(0px, 0px) scale(${r.value})`)};se(()=>{I(),window.addEventListener("scroll",P),window.addEventListener("keydown",B)}),ne(()=>{window.removeEventListener("scroll",P),window.removeEventListener("keydown",B)});const le=async()=>{const e=s.value[n.value],a=y.value+e.fileUrl,l=e.fileName;try{const t=await fetch(a);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.blob(),u=URL.createObjectURL(o),i=document.createElement("a");i.href=u,i.download=l,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u)}catch(t){console.error("下载文件失败:",t);const o=document.createElement("a");o.href=a,o.download=l,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}},oe=async()=>{const e=s.value[n.value],a=y.value+e.fileUrl;try{await navigator.clipboard.writeText(a),F.success("文件地址已复制到剪贴板")}catch(l){console.error("Clipboard API 失败:",l);try{const t=document.createElement("textarea");t.value=a,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.select();const o=document.execCommand("copy");if(document.body.removeChild(t),o)F.success("文件地址已复制到剪贴板");else throw new Error("execCommand 复制失败")}catch(t){console.error("备选复制方法失败:",t),F.error("复制文件地址失败，请手动复制")}}};return(e,a)=>{const l=z("masonry"),t=z("el-icon");return m(),f(A,null,[v("div",fe,[s.value.length>0?(m(),re(l,{key:0,cols:{default:5,1200:4,1024:3,768:2,500:1},gutter:{default:"5px"}},{default:L(()=>[(m(!0),f(A,null,ie(s.value,(o,u)=>(m(),f("div",{class:"item",key:o.fileId,onClick:i=>Z(u)},[v("div",pe,[o.mimeType.startsWith("image/")?(m(),f("img",{key:0,src:y.value+o.thumbnailUrl,alt:o.fileName,class:"media-thumbnail"},null,8,ye)):o.mimeType.startsWith("video/")?(m(),f("div",we,[v("img",{src:y.value+o.thumbnailUrl,alt:o.fileName,class:"media-thumbnail"},null,8,ge),a[1]||(a[1]=v("div",{class:"play-icon"},"▶",-1))])):b("",!0)])],8,he))),128))]),_:1})):(m(),f("div",xe,"当前分类没有数据哦！")),x.value?(m(),f("div",_e,"加载中...")):b("",!0),E.value?(m(),f("div",be,"已经到底啦！")):b("",!0)]),S.value?(m(),f("div",{key:0,class:"media-viewer-modal",onClick:N},[v("button",{class:"close-button",onClick:g(N,["stop"])},"×"),v("div",ke,[v("h3",null,k(J(s.value[n.value].fileName)),1),v("p",null,"文件大小: "+k(G(s.value[n.value].fileSize)),1),v("p",null,"尺寸: "+k(s.value[n.value].width)+" x "+k(s.value[n.value].height),1),v("p",null,"文件类型: "+k(Q(s.value[n.value].mimeType)),1),T(t,{class:"copy-icon",onClick:g(oe,["stop"])},{default:L(()=>[T(j(ce))]),_:1}),T(t,{class:"download-icon",onClick:g(le,["stop"])},{default:L(()=>[T(j(ue))]),_:1})]),v("button",{class:"nav-button prev",onClick:g(Y,["stop"])},"‹"),v("button",{class:"nav-button next",onClick:g(R,["stop"])},"›"),v("div",{class:"media-viewer-content",onClick:a[0]||(a[0]=g(()=>{},["stop"])),onWheel:ee,onMousemove:ae,onMouseup:X,onMouseleave:X},[h.value==="image"?(m(),f("img",{key:0,src:y.value+s.value[n.value].fileUrl,alt:s.value[n.value].fileName,class:"viewer-media",style:de({transform:`translate(${p.value.x}px, ${p.value.y}px) scale(${d.value})`,transition:U.value?"none":"transform 0.1s ease",cursor:d.value>r.value?"grab":"default"}),onMousedown:te},null,44,Me)):h.value==="video"?(m(),f("video",{key:1,src:y.value+s.value[n.value].fileUrl,controls:"",autoplay:"",class:"viewer-media"}," 您的浏览器不支持视频播放。 ",8,Ce)):b("",!0)],32)])):b("",!0)],64)}}},$e=ve(Se,[["__scopeId","data-v-6d57504d"]]);export{$e as default};
